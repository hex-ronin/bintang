# Bintang Drop-in Court Summary

This repo contains code that extracts how many courts can be reserved in Bintang.  It is intended to be low overhead to Bintang's servers but provides a quick way for Bintang members to figure out whether a certain location has a sufficient number of free courts for them to drop-in. 

## Code
The main code is in `find-free.sh`.  It takes three parameters.  
  1. The directory where the configuration files are.  These configuration files give specific information about each Bintang location that the script uses.
  1. The directory that holds any temporary files generated by the script.  The script leaves temporary files after each execution in case they are needed to be debugged.  They are cleaned up at the beginning of the run of the script if the same temporary directory is given.
  1. The directory where the `summary.html` is written to.  This is the directory where your webserver should be pointing at.

## Setup
The code uses standard unix utilities so it can only be run on Linux or Mac.  It uses two utilities that doesn't come standard but are easy to install.
- httpie
- jq

On the Mac, you'll need to install the `core-utils` using `brew` and change the `DATE_PROG` variable in the script to point to `gdate` because Mac `date` utility doesn't use the same parameters.

## Usage
```
# The following gives the conf directory as first parameter and the current directory as both the temporary and final location.
$ ./find-free.sh ./conf . . 

# The following uses Linux tmp as the temporary location
$ ./find-free.sh ./conf /tmp .
```

## Automatic Run
You can run this as a cron job.  

```
# This runs it every hour from 8-3pm.  Make sure to change the directories.
0 8-15 * * * ./find-free.sh ./conf /tmp /public-html
```

## Web Server

This repo also contains a `bintang.yml` which deploys a web server in kubernetes that can be used to serve up the web page generated.  You just need to change the directory in the file to be the directory where you put the `summary.html`.  

Alteratively, you can also use docker to run a container.
```
$ docker run -dit --name bintang-web-server -p 8080:80 -v [directory to the summary.html]:/usr/local/apache2/htdocs/ httpd:2.4
```
